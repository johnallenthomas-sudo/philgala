<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Check-In for Silver Medallion Gala</title>
  <meta name="description" content="Enter your details to generate a boarding pass style PNG with an embedded QR code. All processing happens locally in your browser." />

  <!-- Tailwind for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- QR generator (MIT) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    canvas { image-rendering: crisp-edges; image-rendering: -webkit-optimize-contrast; }
    :root { --page-bg: #f5f2ec; }
  </style>
</head>
<body class="min-h-screen text-slate-800" id="bodyEl" style="background-color: var(--page-bg);">
  <!-- ===== Header (EDITABLE TEXT) ===== -->
  <header class="bg-white border-b sticky top-0 z-10">
    <div class="max-w-5xl mx-auto px-4 py-6">
      <!-- EDIT TITLE BELOW -->
      <h1 class="text-2xl sm:text-3xl font-semibold">Check-In Now for Silver Medallion Gala</h1>
      <!-- EDIT BODY PARAGRAPH BELOW -->
      <p class="mt-2 text-sm text-slate-600">We are so excited to have you onboard soon! Fill out the necessary info below and save a copy of your boarding pass. You'll need to show it at check-in..</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-6 space-y-6">
    <!-- ===== Donation banner at top ===== -->
    <section class="bg-slate-100 p-4 rounded-xl text-center">
      <p class="text-sm text-slate-700">In lieu of gifts we ask you to consider donating to WaterAid to help Phil hit his fundraising goal ahead of the Berlin Marathon.</p>
      <a href="https://www.justgiving.com/page/phil-reville-1" target="_blank" class="inline-block mt-3 px-5 py-2 bg-blue-600 text-white text-sm font-medium rounded-xl hover:bg-blue-500">Donate Now</a>
    </section>

    <!-- ===== Form & Preview ===== -->
    <section class="bg-white shadow rounded-2xl p-5">
      <h3 class="text-lg font-semibold mb-3">Enter your info</h3>
      <form id="infoForm" class="space-y-4" onsubmit="event.preventDefault(); renderBoardingPass();">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <label class="block">
            <span class="text-sm">Full name</span>
            <input id="fullName" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" placeholder="Jane Doe" />
          </label>
          <label class="block">
            <span class="text-sm">Email</span>
            <input id="email" type="email" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" placeholder="jane@example.com" />
          </label>
          <label class="block">
            <span class="text-sm">Phone</span>
            <input id="phone" type="tel" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" placeholder="+1 555 123 4567" />
          </label>
          <label class="block">
            <span class="text-sm">Preferred Airline</span>
            <input id="prefAirline" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" placeholder="Delta, United, etc." />
          </label>
          <label class="block">
            <span class="text-sm">Current Airline Status</span>
            <input id="status" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" placeholder="Gold, 1K, Diamond…" />
          </label>
          <div class="block">
            <span class="text-sm">Do you have PreCheck?</span>
            <div class="mt-1 flex gap-4 items-center">
              <label class="inline-flex items-center gap-2">
                <input type="radio" name="precheck" value="Yes" class="accent-slate-700" checked>
                <span>Yes</span>
              </label>
              <label class="inline-flex items-center gap-2">
                <input type="radio" name="precheck" value="No" class="accent-slate-700">
                <span>No</span>
              </label>
            </div>
          </div>
        </div>

        <!-- ===== Brand settings (EDIT HERE) ===== -->
        <details class="rounded-xl border p-4 bg-slate-50">
          <summary class="cursor-pointer select-none font-medium">Optional: brand settings</summary>
          <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-4">
            <label class="block">
              <span class="text-sm">Logo path (relative URL)</span>
              <!-- EDIT: Replace with your logo file path if different -->
              <input id="logoSrc" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" value="./jane-st-air-logo.png" />
            </label>
            <label class="block">
              <span class="text-sm">Page background color</span>
              <!-- EDIT: Change to match your logo’s background (e.g., #f5f2ec) -->
              <input id="bgColor" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" value="#f5f2ec" />
            </label>
            <label class="block">
              <span class="text-sm">Logo scale (%)</span>
              <!-- EDIT: Increase if your logo appears tiny -->
              <input id="logoScale" type="number" min="50" max="300" step="5" class="mt-1 w-full rounded-xl border-slate-300 focus:border-slate-500" value="120" />
            </label>
          </div>
          <p class="text-xs text-slate-500 mt-2">Put your logo image in the same folder and name it <code>jane-st-air-logo.png</code>, or change the path above. If the logo appears small, bump the <em>Logo scale (%)</em>.</p>
        </details>

        <div class="flex flex-wrap items-center gap-3">
          <button type="submit" class="px-4 py-2 rounded-xl bg-slate-900 text-white">Generate / Update</button>
          <button type="button" id="downloadPngBtn" class="px-4 py-2 rounded-xl border">Download Boarding Pass PNG</button>
        </div>

        <!-- Preview under buttons for mobile friendliness -->
        <div class="mt-6">
          <h3 class="text-lg font-semibold mb-2">Boarding pass preview</h3>
          <div class="rounded-2xl border bg-white p-4 overflow-auto">
            <canvas id="passCanvas" class="w-full h-auto max-w-full"></canvas>
          </div>
        </div>
      </form>
    </section>
  </main>

  <script>
    const form = document.getElementById('infoForm');
    const downloadBtn = document.getElementById('downloadPngBtn');
    const canvas = document.getElementById('passCanvas');
    const bodyEl = document.getElementById('bodyEl');

    // High-res canvas for crisp download
    const W = 1200, H = 600;
    canvas.width = W; canvas.height = H;
    const ctx = canvas.getContext('2d');

    function getValues(){
      const fd = new FormData(form);
      return {
        fullName: document.getElementById('fullName').value.trim() || 'JANE DOE',
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        prefAirline: document.getElementById('prefAirline').value.trim() || '',
        status: document.getElementById('status').value.trim() || '',
        precheck: fd.get('precheck') || 'Yes',
        logoSrc: document.getElementById('logoSrc').value.trim() || './jane-st-air-logo.png',
        bgColor: document.getElementById('bgColor').value.trim() || '#f5f2ec',
        logoScale: Math.max(50, Math.min(300, parseInt(document.getElementById('logoScale').value || '120', 50)))
      };
    }

    function buildQRPayload(v){
      const payload = {
        fullName: v.fullName,
        email: v.email || undefined,
        phone: v.phone || undefined,
        preferredAirline: v.prefAirline || undefined,
        currentStatus: v.status || undefined,
        precheck: v.precheck || undefined,
        generatedAt: new Date().toISOString()
      };
      return JSON.stringify(payload);
    }

    function generateQRCanvas(text, size=260){
      return new Promise((resolve)=>{
        const holder = document.createElement('div');
        holder.style.position = 'absolute';
        holder.style.left = '-9999px';
        document.body.appendChild(holder);
        const q = new QRCode(holder, { text, width: size, height: size, correctLevel: QRCode.CorrectLevel.M });
        requestAnimationFrame(()=>{
          const c = holder.querySelector('canvas');
          if(c){ document.body.removeChild(holder); resolve(c); return; }
          const img = holder.querySelector('img');
          if(img){
            const tmp = document.createElement('canvas'); tmp.width = size; tmp.height = size;
            const ictx = tmp.getContext('2d');
            const im = new Image(); im.onload = ()=>{ ictx.drawImage(im,0,0,size,size); document.body.removeChild(holder); resolve(tmp); };
            im.src = img.src;
          } else {
            const empty = document.createElement('canvas'); empty.width = size; empty.height = size; document.body.removeChild(holder); resolve(empty);
          }
        });
      });
    }

    function roundRectPath(c, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      c.beginPath();
      c.moveTo(x+rr, y);
      c.arcTo(x+w, y, x+w, y+h, rr);
      c.arcTo(x+w, y+h, x, y+h, rr);
      c.arcTo(x, y+h, x, y, rr);
      c.arcTo(x, y, x+w, y, rr);
      c.closePath();
    }

    function loadImage(src){
      return new Promise((resolve, reject)=>{ const im = new Image(); im.onload = ()=>resolve(im); im.onerror = reject; im.src = src; });
    }

    async function renderBoardingPass(){
      const v = getValues();
      // sync page background with control
      document.documentElement.style.setProperty('--page-bg', v.bgColor);

      // clear
      ctx.clearRect(0,0,W,H);

      // Card background
      roundRectPath(ctx, 16, 16, W-32, H-32, 28);
      ctx.fillStyle = '#ffffff';
      ctx.fill();

      const pad = 40; const topY = 56;

      // Draw logo larger, controlled by scale
      try{
        const img = await loadImage(v.logoSrc);
        const baseH = 140; // baseline height for a normal logo
        const drawH = Math.round(baseH * (v.logoScale/100));
        const ratio = img.width / img.height || 1;
        const drawW = Math.round(drawH * ratio);
        ctx.drawImage(img, pad, topY - 10, drawW, drawH);
      } catch(e){
        // Fallback text if logo fails
        ctx.font = '700 32px system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
        ctx.fillStyle = '#0f2a3a';
        ctx.fillText('JANE ST. AIR', pad, topY + 20);
      }

      // Title on right
      ctx.font = '700 40px system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
      ctx.fillStyle = '#0f2a3a';
      ctx.textAlign = 'right';
      ctx.fillText('BOARDING PASS', W - pad, topY + 20);
      ctx.textAlign = 'left';

      // Labels + values
      const label = (text, x, y)=>{ ctx.font = '600 16px system-ui, -apple-system, Segoe UI, Roboto, sans-serif'; ctx.fillStyle = '#64748b'; ctx.fillText(text, x, y); };
      const value = (text, x, y)=>{ ctx.font = '800 30px system-ui, -apple-system, Segoe UI, Roboto, sans-serif'; ctx.fillStyle = '#0f2a3a'; ctx.fillText(text, x, y); };

      let x = pad, y = topY + 120;
      label('Passenger', x, y); value((v.fullName || '').toUpperCase(), x, y + 34);
      y += 84; label('Preferred Airline', x, y); value(v.prefAirline || '—', x, y + 34);
      y += 72; label('Current Status', x, y); value(v.status || '—', x, y + 34);
      y += 72; label('PreCheck', x, y); value(v.precheck, x, y + 34);

      // QR block
      const qrSize = 260;
      const qrX = W - pad - qrSize - 8;
      const qrY = H - pad - qrSize - 8;
      roundRectPath(ctx, qrX-16, qrY-16, qrSize+32, qrSize+32, 18);
      ctx.fillStyle = '#f1f5f9';
      ctx.fill();
      const qrCanvas = await generateQRCanvas(buildQRPayload(v), qrSize);
      ctx.drawImage(qrCanvas, qrX, qrY, qrSize, qrSize);
    }

    async function handleDownload(){
      await renderBoardingPass();
      const link = document.createElement('a');
      link.download = 'boarding-pass.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    // Debounced live updates
    let t; form.addEventListener('input', ()=>{ clearTimeout(t); t = setTimeout(renderBoardingPass, 200); });
    downloadBtn.addEventListener('click', handleDownload);

    // Initial demo values
    document.getElementById('fullName').value = 'Phil Reville';
    document.getElementById('prefAirline').value = 'Delta';
    document.getElementById('status').value = 'Gold Medallion';
    renderBoardingPass();
  </script>
</body>
</html>
